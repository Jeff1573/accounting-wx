# 开发规范

本文档定义项目的开发规范和最佳实践。

## 一、代码风格

### 1. TypeScript 规范

**命名规范：**
- 类名：PascalCase，如 `UserController`
- 接口：PascalCase，如 `UserAttributes`
- 函数/方法：camelCase，如 `getUserInfo`
- 变量：camelCase，如 `userName`
- 常量：UPPER_SNAKE_CASE，如 `API_BASE_URL`
- 私有属性/方法：前缀 `_`，如 `_privateMethod`

**类型定义：**
```typescript
// 好的实践
interface User {
  id: number;
  name: string;
}

function getUser(id: number): Promise<User> {
  // ...
}

// 避免使用 any
const data: any = {}; // ❌
const data: User = {}; // ✅
```

**函数注释（JSDoc）：**
```typescript
/**
 * 获取用户信息
 * 
 * @param userId - 用户ID
 * @returns Promise<User> 用户对象
 * 
 * @example
 * const user = await getUser(1);
 */
async function getUser(userId: number): Promise<User> {
  // ...
}
```

### 2. Vue 组件规范

**组件命名：**
- 文件名：PascalCase，如 `MemberCard.vue`
- 组件名：PascalCase
- Props 名：camelCase

**组件结构：**
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 导入
import { ref, computed } from 'vue';

// Props 定义
interface Props {
  title: string;
  count?: number;
}

const props = withDefaults(defineProps<Props>(), {
  count: 0
});

// Emits 定义
const emit = defineEmits<{
  change: [value: string];
}>();

// 响应式数据
const data = ref('');

// 计算属性
const doubleCount = computed(() => props.count * 2);

// 方法
function handleClick() {
  emit('change', data.value);
}
</script>

<style scoped>
/* 样式 */
</style>
```

### 3. API 接口规范

**请求命名：**
```typescript
// 动词 + 名词
getUser()
createRoom()
updateMember()
deleteTransaction()
```

**响应格式：**
```typescript
// 成功响应
{
  "data": { ... },
  "message": "success"
}

// 错误响应
{
  "error": "错误信息",
  "code": "ERROR_CODE"
}
```

## 二、Git 规范

### 1. 分支管理

```
main/master     # 主分支，生产环境
develop         # 开发分支
feature/xxx     # 功能分支
bugfix/xxx      # 修复分支
hotfix/xxx      # 紧急修复分支
```

### 2. Commit 规范

使用约定式提交（Conventional Commits）：

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type 类型：**
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档变更
- `style`: 代码格式（不影响功能）
- `refactor`: 重构（既不是新功能也不是修复）
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

**示例：**
```bash
feat(room): 添加房间分享功能

- 添加分享按钮
- 实现邀请码复制
- 添加分享统计

Closes #123
```

### 3. Pull Request 规范

**PR 标题：**
```
[Feature] 添加房间分享功能
[Bugfix] 修复登录失败问题
[Docs] 更新部署文档
```

**PR 描述模板：**
```markdown
## 变更类型
- [ ] 新功能
- [ ] Bug 修复
- [ ] 文档更新
- [ ] 代码重构
- [ ] 性能优化

## 变更说明
简要描述本次变更的内容

## 测试说明
- [ ] 单元测试通过
- [ ] 手动测试通过
- [ ] 无 Linter 错误

## 截图（如有必要）
```

## 三、数据库规范

### 1. 表命名

- 小写 + 下划线
- 复数形式
- 如：`users`, `room_members`, `transactions`

### 2. 字段命名

- 小写 + 下划线
- 主键：`id`
- 外键：`表名_id`，如 `user_id`
- 时间戳：`created_at`, `updated_at`

### 3. 索引规范

- 主键索引：`PRIMARY`
- 唯一索引：`uk_字段名`
- 普通索引：`idx_字段名`
- 联合索引：`idx_字段1_字段2`

### 4. 注释规范

所有表和字段都必须有注释：
```sql
CREATE TABLE users (
  id INT COMMENT '用户ID',
  name VARCHAR(100) COMMENT '用户名'
) COMMENT='用户表';
```

## 四、API 设计规范

### 1. URL 设计

- 使用名词复数形式
- 使用小写字母和连字符
- RESTful 风格

```
GET    /api/rooms          # 获取列表
POST   /api/rooms          # 创建
GET    /api/rooms/:id      # 获取详情
PUT    /api/rooms/:id      # 更新
DELETE /api/rooms/:id      # 删除
```

### 2. HTTP 状态码

- `200` OK - 成功
- `201` Created - 创建成功
- `400` Bad Request - 请求参数错误
- `401` Unauthorized - 未认证
- `403` Forbidden - 无权限
- `404` Not Found - 资源不存在
- `500` Internal Server Error - 服务器错误

### 3. 请求参数

**Query 参数：** 用于过滤、排序、分页
```
GET /api/rooms?page=1&limit=20&sort=created_at
```

**Path 参数：** 用于资源标识
```
GET /api/rooms/:id
```

**Body 参数：** 用于 POST/PUT 请求
```json
POST /api/rooms
{
  "name": "房间名称"
}
```

### 4. 响应格式

**成功响应：**
```json
{
  "id": 1,
  "name": "房间名称",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**列表响应：**
```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "total_pages": 5
  }
}
```

**错误响应：**
```json
{
  "error": "错误描述",
  "code": "ERROR_CODE",
  "details": {...}
}
```

## 五、测试规范

### 1. 单元测试

- 每个函数/方法都应有对应的测试
- 测试文件命名：`xxx.test.ts` 或 `xxx.spec.ts`
- 测试覆盖率目标：> 80%

### 2. 集成测试

- API 接口测试
- 数据库操作测试
- 第三方服务集成测试

### 3. E2E 测试

- 关键业务流程测试
- 用户操作路径测试

## 六、文档规范

### 1. 代码注释

- 所有公共函数/方法必须有 JSDoc 注释
- 复杂逻辑需要添加行内注释
- 注释使用中文

### 2. README 文档

每个模块都应有 README，包含：
- 功能说明
- 使用方法
- API 文档
- 示例代码

### 3. API 文档

- 接口路径
- 请求方法
- 请求参数
- 响应格式
- 示例代码

## 七、安全规范

### 1. 输入验证

- 所有用户输入必须验证
- 防止 SQL 注入
- 防止 XSS 攻击

### 2. 认证授权

- 敏感接口必须验证 token
- 权限检查
- 防止越权访问

### 3. 敏感信息

- 不在代码中硬编码密码、密钥
- 使用环境变量
- 不提交 `.env` 文件

### 4. 错误处理

- 不暴露内部错误信息给前端
- 记录详细错误日志
- 友好的错误提示

## 八、性能规范

### 1. 数据库查询

- 避免 SELECT *
- 使用索引
- 避免 N+1 查询
- 使用分页

### 2. API 响应

- 响应时间 < 200ms
- 使用缓存
- 压缩响应数据

### 3. 前端性能

- 图片优化
- 代码分割
- 懒加载
- 防抖节流

## 九、代码审查规范

### 1. 审查要点

- [ ] 代码功能是否正确
- [ ] 代码风格是否符合规范
- [ ] 是否有安全隐患
- [ ] 是否有性能问题
- [ ] 测试是否完整
- [ ] 文档是否完善

### 2. 审查流程

1. 提交 PR
2. 自动化测试
3. 代码审查
4. 修改反馈
5. 合并代码

## 十、发布规范

### 1. 版本号

遵循语义化版本（Semantic Versioning）：
- 主版本号：不兼容的 API 修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

示例：`1.2.3`

### 2. 发布流程

1. 更新版本号
2. 更新 CHANGELOG
3. 创建 Git Tag
4. 构建生产版本
5. 部署到生产环境
6. 发布说明

### 3. Changelog 格式

```markdown
## [1.2.0] - 2024-01-15

### Added
- 新增房间分享功能
- 新增交易统计报表

### Changed
- 优化登录流程
- 改进 UI 交互

### Fixed
- 修复余额计算错误
- 修复页面刷新问题
```

## 总结

遵守以上规范可以：
- 提高代码质量
- 减少 bug
- 便于团队协作
- 提升开发效率
- 降低维护成本

请所有开发人员认真遵守！

