# 快速启动指南

这是一个快速开始开发的步骤指南，帮助你在 5 分钟内运行项目。

## 前置要求

- ✅ Node.js 16+ 已安装
- ✅ MySQL 8.0+ 已安装并运行
- ✅ 微信开发者工具已安装

## 第一步：数据库准备

```bash
# 1. 登录 MySQL
mysql -u root -p

# 2. 创建数据库
CREATE DATABASE accounting_miniapp CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 3. 退出 MySQL
EXIT;

# 4. 导入数据库结构
mysql -u root -p accounting_miniapp < 数据库初始化.sql
```

## 第二步：安装依赖

本项目使用 npm workspace 管理，在根目录执行一次即可：

```bash
# 在项目根目录安装所有依赖
npm install
```

这会自动安装前端和后端的所有依赖。

## 第三步：配置后端环境变量

```bash
# 复制环境变量模板
cp backend/env.template backend/.env

# 编辑 .env 文件，填写必要配置
# 至少需要修改：
# - DB_PASSWORD (你的 MySQL 密码)
# - JWT_SECRET (随机字符串)
# - WX_APPID (微信小程序 AppID，可以先留空测试)
# - WX_SECRET (微信小程序 Secret，可以先留空测试)
```

## 第四步：启动后端

```bash
# 方式 1：从根目录启动（推荐）
npm run dev:backend

# 方式 2：进入后端目录启动
cd backend && npm run dev
```

看到以下输出表示后端启动成功：
```
✅ 数据库连接成功
✅ 数据库同步成功
🚀 服务器运行在 http://localhost:3000
📝 环境: development
```

## 第五步：启动前端

```bash
# 方式 1：从根目录启动（推荐）
npm run dev:frontend

# 方式 2：进入前端目录启动
cd frontend && npm run dev:mp-weixin

# 注意：修改 API 地址（如果需要）
# 编辑 frontend/src/utils/request.ts
# 确认 BASE_URL 为：http://localhost:3000/api
```

## 第六步：在微信开发者工具中打开

1. 打开**微信开发者工具**
2. 选择"导入项目"
3. 选择目录：`frontend/dist/dev/mp-weixin`
4. AppID：选择"测试号"（开发阶段）
5. 点击"导入"

## 💡 使用 npm workspace 的优势

本项目已配置 npm workspace，你可以：

```bash
# 一次安装所有依赖
npm install

# 同时启动前后端
npm run dev

# 统一构建
npm run build

# 查看更多 workspace 命令
cat workspace使用指南.md
```

详细使用方法请查看 [workspace使用指南.md](./workspace使用指南.md)

## 第七步：测试功能

### 测试登录（开发模式）

由于是开发阶段，可能无法真正调用微信登录。你可以：

**方式 1：在微信开发者工具中测试**
- 点击"编译"
- 在模拟器中点击"微信授权登录"
- 如果有测试号，可以正常登录

**方式 2：使用 Postman 测试后端 API**

```bash
# 测试健康检查
curl http://localhost:3000/health

# 测试登录接口（模拟数据）
curl -X POST http://localhost:3000/api/auth/wx-login \
  -H "Content-Type: application/json" \
  -d '{
    "code": "test_code",
    "nickname": "测试用户",
    "avatar": "https://example.com/avatar.jpg"
  }'
```

### 测试房间功能

1. 登录成功后会跳转到房间列表页
2. 点击"创建房间"
3. 输入房间名称，如"周末聚餐"
4. 创建成功后会获得邀请码
5. 点击房间卡片进入房间详情
6. 尝试点击"+"按钮或成员卡片进行转账

## 常见问题

### Q1: 后端启动失败 - 数据库连接错误

**解决方法：**
1. 确认 MySQL 已启动：`sudo systemctl status mysql` (Linux) 或在任务管理器查看 (Windows)
2. 检查 `.env` 中的数据库配置是否正确
3. 确认数据库已创建：`mysql -u root -p -e "SHOW DATABASES;"`

### Q2: 前端无法启动 - 依赖安装失败

**解决方法：**
```bash
# 清除 node_modules 和缓存
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

### Q3: 微信开发者工具中报错 - 域名不合法

**解决方法：**
1. 在微信开发者工具中：
2. 点击右上角"详情"
3. 勾选"不校验合法域名..."

### Q4: 登录失败 - 微信接口调用失败

**解决方法：**

**开发阶段：**
- 暂时不需要真实的微信 AppID 和 Secret
- 可以修改后端代码临时绕过微信验证进行功能测试

**正式使用：**
1. 在[微信公众平台](https://mp.weixin.qq.com/)注册小程序
2. 获取 AppID 和 Secret
3. 填写到后端 `.env` 文件
4. 填写到前端 `src/manifest.json`

### Q5: API 请求失败 - 网络错误

**解决方法：**
1. 确认后端服务正在运行
2. 检查 `frontend/src/utils/request.ts` 中的 `BASE_URL` 是否正确
3. 在微信开发者工具中关闭域名校验

## 开发技巧

### 1. 实时查看后端日志

后端运行时会实时输出日志，包括：
- 数据库连接状态
- API 请求记录
- 错误信息

### 2. 数据库管理工具

推荐使用以下工具管理数据库：
- **Navicat**
- **DBeaver**
- **MySQL Workbench**
- **phpMyAdmin**

### 3. API 测试工具

推荐使用：
- **Postman**
- **Insomnia**
- **VS Code REST Client 插件**

### 4. 代码编辑器推荐配置

**VS Code 推荐插件：**
- ESLint
- Prettier
- Volar (Vue 3)
- TypeScript Vue Plugin

## 下一步

完成快速启动后，你可以：

1. 📖 阅读 [README.md](./README.md) 了解项目详情
2. 🔧 阅读 [backend/README.md](./backend/README.md) 了解后端 API
3. 📱 阅读 [frontend/README.md](./frontend/README.md) 了解前端开发
4. 🚀 阅读 [部署指南.md](./部署指南.md) 准备生产部署

## 获取帮助

- 查看项目文档
- 提交 GitHub Issue
- 查看常见问题解答

祝开发顺利！ 🎉

